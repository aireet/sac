# Claude Code Sandbox Platform

ä¼ä¸šå†…éƒ¨ Claude Code æ²™ç®±å¹³å°ï¼Œä¸ºéæŠ€æœ¯äººå‘˜æä¾›åŸºäº xterm.js çš„ Web ç»ˆç«¯è®¿é—®ã€‚

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            Browser (è¿è¥äººå‘˜æ“ä½œç•Œé¢)                                      â”‚
â”‚                                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  xterm.js Terminal       â”‚  â”‚  Skill Panel         â”‚  â”‚  Skill Register          â”‚  â”‚
â”‚  â”‚  - claudeå¯¹è¯ç•Œé¢             â”‚  â”‚  (æŠ€èƒ½å¿«æ·åˆ—è¡¨)        â”‚  â”‚  (æŠ€èƒ½æ³¨å†Œå™¨)            â”‚  â”‚
â”‚  â”‚  - è‡ªç„¶è¯­è¨€äº¤äº’             â”‚  â”‚                      â”‚  â”‚                          â”‚  â”‚
â”‚  â”‚  - å®æ—¶è¾“å‡ºæµ              â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  - æ”¯æŒå¯Œæ–‡æœ¬/è¡¨æ ¼æ¸²æŸ“   â”‚  â”‚  â”‚ æ•°æ®æŸ¥è¯¢      â”‚   â”‚    â”‚  â”‚ å®˜æ–¹ Skill         â”‚ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ - æœ¬å‘¨é”€å”®é¢  â”‚     â”‚  â”‚  â”‚ (ç ”å‘æä¾›)         â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ - ç”¨æˆ·å¢é•¿    â”‚    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ - è®¢å•ç»Ÿè®¡    â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚              â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚ è‡ªå®šä¹‰ Skill       â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â”‚ (è¿è¥åˆ›å»º)         â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ æ•°æ®å¤„ç†      â”‚   â”‚  â”‚  â”‚                    â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ - æ•°æ®æ¸…æ´—    â”‚   â”‚  â”‚  â”‚ ğŸ“ åˆ›å»º            â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ - æ ¼å¼è½¬æ¢    â”‚   â”‚  â”‚  â”‚ âœï¸  ç¼–è¾‘            â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ - å¯¼å‡ºæŠ¥è¡¨    â”‚   â”‚  â”‚  â”‚ ğŸ—‘ï¸  åˆ é™¤            â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚  â”‚ ğŸ“¤ åˆ†äº«            â”‚ â”‚  â”‚
â”‚              â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚              â”‚                  â”‚  â”‚ å†å²æŸ¥è¯¢      â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                  â”‚  â”‚ - å¸¸ç”¨æ”¶è—    â”‚   â”‚              â”‚                  â”‚
â”‚              â”‚                  â”‚  â”‚ - ä¸€é”®é‡æ‰§è¡Œ  â”‚   â”‚              â”‚                  â”‚
â”‚              â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚                  â”‚
â”‚              â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                  â”‚
â”‚              â”‚                             â”‚                          â”‚                  â”‚
â”‚              â”‚                             â”‚        REST API          â”‚                  â”‚
â”‚              â”‚                             â”‚   (CRUD Skill å®šä¹‰)      â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                      å…±äº«åŒä¸€ä¸ª WebSocket                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚ WebSocket (ws://host/ws/userId/sessionId)
                                             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Istio Ingress Gateway                                      â”‚
â”‚                                                                                         â”‚
â”‚  /ws/:userId/:sessionId  â†’  WebSocket Proxy                                            â”‚
â”‚  /api/*                  â†’  API Gateway                                                â”‚
â”‚  /hooks/conversation     â†’  Hook Collector                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“                                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Go Backend Services        â”‚              â”‚   PostgreSQL/MongoDB         â”‚
â”‚                              â”‚              â”‚   (å¯¹è¯æ—¥å¿—å­˜å‚¨)             â”‚
â”‚  â”œâ”€ WebSocket Proxy          â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚   (åŒå‘é€æ˜è½¬å‘)          â”‚
â”‚  â”œâ”€ Container Manager        â”‚
â”‚  â”œâ”€ Hook Collector           â”‚
â”‚  â”œâ”€ Skill Registry           â”‚
â”‚  â””â”€ Auth Service             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ æŸ¥è¯¢ Pod IP & è½¬å‘ WebSocket
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Kubernetes Cluster                                         â”‚
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  User Pod: claude-code-user-001-session-abc                                   â”‚     â”‚
â”‚  â”‚                                                                               â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  ttyd (Port 7681)                                                       â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - è½»é‡çº§ WebSocket æœåŠ¡å™¨                                               â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - æš´éœ² /ws endpoint                                                    â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - å¯åŠ¨å‘½ä»¤: bash æˆ– claude                                              â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚                       â”‚ PTY (ä¼ªç»ˆç«¯)                                          â”‚     â”‚
â”‚  â”‚                       â†“                                                       â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚
â”‚  â”‚  â”‚  Bash Shell / Claude Code CLI                                           â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - æ¥æ”¶å‘½ä»¤å¹¶æ‰§è¡Œ                                                        â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - Custom Skills (/home/claude/.claude/...)                             â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - Hooks (å‘é€å¯¹è¯åˆ°åç«¯)                                                â”‚ â”‚     â”‚
â”‚  â”‚  â”‚  - Working Directory: /workspace                                        â”‚ â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚
â”‚  â”‚                                                                               â”‚     â”‚
â”‚  â”‚  Resources: CPU 2 cores, Memory 4Gi, Storage 10Gi                            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµè¯¦è§£

**1. ç”¨æˆ·è¾“å…¥æµç¨‹**
```
ç”¨æˆ·é”®ç›˜è¾“å…¥ "ls -la" + Enter
    â†“
xterm.js æ•è· onData äº‹ä»¶
    â†“
WebSocket.send("ls -la\r")
    â†“
Go WebSocket Proxy (é€æ˜è½¬å‘)
    â†“
ttyd æ¥æ”¶å­—ç¬¦æµ (å®¹å™¨å†… :7681/ws)
    â†“
å†™å…¥ PTY (ä¼ªç»ˆç«¯)
    â†“
Bash/Claude è¿›ç¨‹æ‰§è¡Œå‘½ä»¤
```

**2. Skill Panel äº¤äº’æµç¨‹**
```
ç”¨æˆ·ç‚¹å‡» [æœ¬å‘¨é”€å”®é¢] æŒ‰é’®
    â†“
JavaScript: ws.send("/query-sales --period=this-week\r")
    â†“
Go WebSocket Proxy (é€æ˜è½¬å‘)
    â†“
ttyd æ¥æ”¶å‘½ä»¤å­—ç¬¦ä¸²
    â†“
å†™å…¥ PTY
    â†“
Claude Code æ‰§è¡Œ /query-sales skill
    â†“
è¾“å‡ºç»“æœ â†’ PTY â†’ ttyd â†’ Go Proxy â†’ xterm.js æ˜¾ç¤º
```

**3. Skill Register å·¥ä½œæµç¨‹**
```
è¿è¥ç”¨æˆ·åœ¨å‰ç«¯åˆ›å»ºè‡ªå®šä¹‰ Skill
    â†“
å‰ç«¯: POST /api/skills (åŒ…å« skill å®šä¹‰)
    â†“
Go Backend Skill Registry (å­˜å‚¨åˆ° PostgreSQL)
    â†“
å¼‚æ­¥åŒæ­¥åˆ°ç”¨æˆ·å®¹å™¨
    â†“
å†™å…¥ /home/claude/.claude/skills/custom/my-skill.md
    â†“
Claude Code çƒ­åŠ è½½æ–° Skill
    â†“
å‰ç«¯ Skill Panel è‡ªåŠ¨åˆ·æ–°æ˜¾ç¤ºæ–°æŒ‰é’®
```

**4. å…³é”®ç‰¹æ€§**
- xterm.js å’Œ Skill Panel å…±äº«åŒä¸€ä¸ª WebSocket è¿æ¥
- ttyd å¯¹å‘½ä»¤æ¥æºæ— æ„ŸçŸ¥ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰å­—ç¬¦æµ
- å‰ç«¯ä»»ä½• UI æ“ä½œéƒ½å¯ä»¥é€šè¿‡å‘é€å‘½ä»¤å­—ç¬¦ä¸²å®ç°äº¤äº’
- æ”¯æŒï¼šæŒ‰é’®ç‚¹å‡»ã€å¿«æ·é”®ã€æ‹–æ‹½æ–‡ä»¶ã€å³é”®èœå•ç­‰
- è¿è¥å¯è‡ªåŠ©åˆ›å»ºã€ç¼–è¾‘ã€åˆ†äº«è‡ªå®šä¹‰ Skill
- Skill å®šä¹‰æ”¯æŒå‚æ•°åŒ–ï¼Œå¯å¤ç”¨

## æ ¸å¿ƒåŠŸèƒ½

### 1. å¯¹è¯é‡‡é›†ï¼ˆé€šè¿‡ Hooksï¼‰

Claude Code é…ç½®æ–‡ä»¶ `~/.claude/config.json`:
```json
{
  "hooks": {
    "on-user-message": "curl -X POST http://hook-collector-service:8080/hooks/conversation -H 'Content-Type: application/json' -d '{\"user_id\":\"$USER_ID\",\"session_id\":\"$SESSION_ID\",\"type\":\"user\",\"content\":\"$MESSAGE\",\"timestamp\":\"$TIMESTAMP\"}' &",
    "on-assistant-message": "curl -X POST http://hook-collector-service:8080/hooks/conversation -H 'Content-Type: application/json' -d '{\"user_id\":\"$USER_ID\",\"session_id\":\"$SESSION_ID\",\"type\":\"assistant\",\"content\":\"$MESSAGE\",\"timestamp\":\"$TIMESTAMP\"}' &"
  }
}
```

### 2. é¢„è®¾ Skills

å‰ç«¯å±•ç¤ºå¸¸ç”¨æ“ä½œæŒ‰é’®ï¼Œé€šè¿‡ WebSocket å‘é€å‘½ä»¤åˆ°å®¹å™¨ï¼š

```typescript
// å®ç°åŸç†
const executeSkill = (command: string) => {
  if (ws.readyState === WebSocket.OPEN) {
    ws.send(command + '\r');  // \r æ˜¯å›è½¦é”®
  }
};

// è¿è¥åœºæ™¯ Skills ç¤ºä¾‹
skills = [
  // æ•°æ®æŸ¥è¯¢ç±»
  {
    name: 'æœ¬å‘¨é”€å”®é¢',
    command: '/query-sales --period=this-week',
    icon: 'ğŸ’°',
    category: 'æ•°æ®æŸ¥è¯¢'
  },
  {
    name: 'ç”¨æˆ·å¢é•¿è¶‹åŠ¿',
    command: '/query-user-growth --days=30',
    icon: 'ğŸ“ˆ',
    category: 'æ•°æ®æŸ¥è¯¢'
  },
  {
    name: 'è®¢å•ç»Ÿè®¡',
    command: '/query-orders --status=all',
    icon: 'ğŸ“¦',
    category: 'æ•°æ®æŸ¥è¯¢'
  },

  // æ•°æ®åˆ†æç±»
  {
    name: 'æ¸ é“è½¬åŒ–åˆ†æ',
    command: '/analyze-conversion',
    icon: 'ğŸ¯',
    category: 'æ•°æ®åˆ†æ'
  },
  {
    name: 'ç”¨æˆ·ç•™å­˜åˆ†æ',
    command: '/analyze-retention',
    icon: 'ğŸ”„',
    category: 'æ•°æ®åˆ†æ'
  },

  // æŠ¥è¡¨ç”Ÿæˆç±»
  {
    name: 'ç”Ÿæˆå‘¨æŠ¥',
    command: '/report-weekly',
    icon: 'ğŸ“Š',
    category: 'æŠ¥è¡¨ç”Ÿæˆ'
  },
  {
    name: 'å¯¼å‡ºExcel',
    command: '/export-excel',
    icon: 'ğŸ“‘',
    category: 'æŠ¥è¡¨ç”Ÿæˆ'
  },
];
```

**æ”¯æŒçš„äº¤äº’æ–¹å¼**ï¼š
- âœ… æŒ‰é’®ç‚¹å‡»
- âœ… å¿«æ·é”®ç»‘å®š (Ctrl+1, Ctrl+2...)
- âœ… å³é”®èœå•
- âœ… å¸¦å‚æ•°çš„å‘½ä»¤ (`/query-sales --period=this-week`)
- âœ… å‘½ä»¤é˜Ÿåˆ— (æ‰¹é‡æ‰§è¡Œå¤šä¸ªå‘½ä»¤)

### 3. Skill Register (æŠ€èƒ½æ³¨å†Œå™¨)

è¿è¥äººå‘˜å¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢è‡ªåŠ©åˆ›å»ºã€ç®¡ç†è‡ªå®šä¹‰ Skillï¼Œæ— éœ€ç¼–å†™ä»£ç ã€‚

#### 3.1 Skill å®šä¹‰ç»“æ„

```typescript
interface SkillDefinition {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  name: string;                  // æ˜¾ç¤ºåç§°
  description: string;           // åŠŸèƒ½æè¿°
  icon: string;                  // å›¾æ ‡
  category: string;              // åˆ†ç±»ï¼ˆæ•°æ®æŸ¥è¯¢/æ•°æ®åˆ†æ/æŠ¥è¡¨ç”Ÿæˆï¼‰
  prompt: string;                // å‘é€ç»™ Claude çš„æç¤ºè¯
  parameters?: SkillParameter[]; // å¯é€‰å‚æ•°
  isOfficial: boolean;           // æ˜¯å¦å®˜æ–¹ Skill
  createdBy: string;             // åˆ›å»ºè€…
  isPublic: boolean;             // æ˜¯å¦å…¬å¼€åˆ†äº«
  createdAt: string;
  updatedAt: string;
}

interface SkillParameter {
  name: string;                  // å‚æ•°å
  label: string;                 // æ˜¾ç¤ºæ ‡ç­¾
  type: 'text' | 'select' | 'date' | 'number';
  required: boolean;
  defaultValue?: string;
  options?: string[];            // select ç±»å‹çš„é€‰é¡¹
}
```

#### 3.2 åˆ›å»ºè‡ªå®šä¹‰ Skill ç¤ºä¾‹

**åœºæ™¯**: è¿è¥æƒ³è¦æŸ¥è¯¢ç‰¹å®šæ—¶é—´æ®µçš„é€€æ¬¾è®¢å•

```javascript
// åœ¨å‰ç«¯ Skill Register ç•Œé¢å¡«å†™è¡¨å•
{
  name: 'é€€æ¬¾è®¢å•æŸ¥è¯¢',
  description: 'æŸ¥è¯¢æŒ‡å®šæ—¶é—´æ®µå†…çš„é€€æ¬¾è®¢å•ï¼ŒåŒ…å«è®¢å•é‡‘é¢ã€é€€æ¬¾åŸå› ç­‰ä¿¡æ¯',
  icon: 'ğŸ’¸',
  category: 'æ•°æ®æŸ¥è¯¢',
  prompt: `è¯·å¸®æˆ‘æŸ¥è¯¢ {{startDate}} åˆ° {{endDate}} ä¹‹é—´çš„æ‰€æœ‰é€€æ¬¾è®¢å•ã€‚

è¦æ±‚ï¼š
1. è¿æ¥æ•°æ®åº“æŸ¥è¯¢ refund_orders è¡¨
2. ç»Ÿè®¡æ€»é€€æ¬¾é‡‘é¢å’Œè®¢å•æ•°é‡
3. æŒ‰é€€æ¬¾åŸå› åˆ†ç±»æ±‡æ€»
4. ä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºç»“æœ
5. å¦‚æœé€€æ¬¾é‡‘é¢è¶…è¿‡10ä¸‡ï¼Œè¯·ç‰¹åˆ«æ ‡æ³¨`,
  parameters: [
    {
      name: 'startDate',
      label: 'å¼€å§‹æ—¥æœŸ',
      type: 'date',
      required: true
    },
    {
      name: 'endDate',
      label: 'ç»“æŸæ—¥æœŸ',
      type: 'date',
      required: true
    }
  ],
  isPublic: true  // åˆ†äº«ç»™å…¶ä»–è¿è¥åŒå­¦ä½¿ç”¨
}
```

#### 3.3 Skill æ‰§è¡Œæµç¨‹

```
1. ç”¨æˆ·åœ¨ Skill Panel ç‚¹å‡» [é€€æ¬¾è®¢å•æŸ¥è¯¢]
   â†“
2. å¼¹å‡ºå‚æ•°è¾“å…¥è¡¨å•ï¼ˆé€‰æ‹©æ—¥æœŸèŒƒå›´ï¼‰
   â†“
3. å‰ç«¯å°†å‚æ•°å¡«å……åˆ° prompt æ¨¡æ¿
   prompt = prompt.replace('{{startDate}}', '2024-01-01')
                  .replace('{{endDate}}', '2024-01-31')
   â†“
4. é€šè¿‡ WebSocket å‘é€å®Œæ•´ prompt ç»™ Claude
   ws.send(`${filledPrompt}\r`)
   â†“
5. Claude æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢å¹¶è¿”å›ç»“æœ
   â†“
6. ç»“æœåœ¨ Terminal ä¸­å®æ—¶æ˜¾ç¤º
```

#### 3.4 Skill ç®¡ç† API

```typescript
// å‰ç«¯è°ƒç”¨åç«¯ API ç®¡ç† Skill
GET    /api/skills              // è·å–æ‰€æœ‰ Skillï¼ˆå®˜æ–¹ + è‡ªå®šä¹‰ï¼‰
GET    /api/skills/:id          // è·å–å•ä¸ª Skill
POST   /api/skills              // åˆ›å»ºæ–° Skill
PUT    /api/skills/:id          // æ›´æ–° Skill
DELETE /api/skills/:id          // åˆ é™¤ Skill
POST   /api/skills/:id/fork     // å¤åˆ¶å¹¶ä¿®æ”¹ä»–äººçš„ Skill
GET    /api/skills/public       // è·å–æ‰€æœ‰å…¬å¼€åˆ†äº«çš„ Skill
```

#### 3.5 Skill åŒæ­¥æœºåˆ¶

```
åç«¯ Skill Registry å˜æ›´
    â†“
è§¦å‘ K8s ConfigMap æ›´æ–°
    â†“
é€šè¿‡ Kubernetes API åŒæ­¥åˆ°ç”¨æˆ· Pod
    â†“
å†™å…¥ /home/claude/.claude/skills/custom/
    â†“
Claude Code è‡ªåŠ¨åŠ è½½æ–° Skill (inotify ç›‘å¬æ–‡ä»¶å˜åŒ–)
    â†“
WebSocket æ¨é€äº‹ä»¶åˆ°å‰ç«¯
    â†“
å‰ç«¯ Skill Panel è‡ªåŠ¨åˆ·æ–°
```

#### 3.6 æƒé™æ§åˆ¶

- **å®˜æ–¹ Skill**: ä»…ç ”å‘/äº§å“å¯åˆ›å»ºï¼Œæ‰€æœ‰ç”¨æˆ·åªè¯»
- **ä¸ªäºº Skill**: ç”¨æˆ·å¯ CRUD è‡ªå·±åˆ›å»ºçš„ Skill
- **å…¬å¼€ Skill**: åˆ›å»ºè€…å¯é€‰æ‹©å…¬å¼€åˆ†äº«ï¼Œå…¶ä»–ç”¨æˆ·å¯æŸ¥çœ‹å’Œ Fork
- **å›¢é˜Ÿ Skill**: æŒ‰éƒ¨é—¨/å›¢é˜Ÿåˆ’åˆ†ï¼Œå›¢é˜Ÿæˆå‘˜å¯è§

### 4. å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†

- ç”¨æˆ·é¦–æ¬¡ç™»å½•ï¼šåˆ›å»ºä¸“å± Pod
- é—²ç½® 2 å°æ—¶ï¼šè‡ªåŠ¨æš‚åœï¼ˆä¿ç•™æ•°æ®ï¼‰
- é—²ç½® 7 å¤©ï¼šé”€æ¯å®¹å™¨

## æŠ€æœ¯æ ˆ

- **å‰ç«¯**: React + xterm.js + xterm-addon-fit + WebSocket API
- **åç«¯**: Go + Gin + gorilla/websocket + kubernetes/client-go
- **å®¹å™¨ç»ˆç«¯**: ttyd (è½»é‡çº§ WebSocket ç»ˆç«¯æœåŠ¡å™¨)
- **å®¹å™¨åŸºç¡€**: Ubuntu 22.04 + Claude Code CLI + Bash
- **åŸºç¡€è®¾æ–½**: Kubernetes + Istio + PostgreSQL/MongoDB

### æ ¸å¿ƒæŠ€æœ¯é€‰å‹è¯´æ˜

**ttyd**:
- gotty çš„ç°ä»£æ›¿ä»£å“ï¼ŒC è¯­è¨€ç¼–å†™ï¼Œæ€§èƒ½ä¼˜è¶Š
- åŸç”Ÿæ”¯æŒ xterm.jsï¼Œå®Œç¾å…¼å®¹ WebSocket åè®®
- æä¾› PTY (ä¼ªç»ˆç«¯) ç®¡ç†ï¼Œæ— éœ€è‡ªå·±å®ç°
- æ”¯æŒç»ˆç«¯å°ºå¯¸è°ƒæ•´ã€è®¤è¯ã€TLS ç­‰ä¼ä¸šçº§ç‰¹æ€§

## ç›®å½•ç»“æ„

```
claude-code-sandbox/
â”œâ”€â”€ backend/                 # Go åç«¯
â”‚   â”œâ”€â”€ cmd/
â”‚   â”‚   â”œâ”€â”€ api/            # API Gateway
â”‚   â”‚   â”œâ”€â”€ ws-proxy/       # WebSocket ä»£ç†
â”‚   â”‚   â””â”€â”€ hook-collector/ # Hook é‡‡é›†æœåŠ¡
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ container/      # K8s å®¹å™¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ session/        # ä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth/           # è®¤è¯æˆæƒ
â”‚   â”‚   â”œâ”€â”€ skill/          # Skill æ³¨å†Œä¸ç®¡ç†
â”‚   â”‚   â””â”€â”€ storage/        # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ pkg/
â”œâ”€â”€ frontend/               # React å‰ç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ Terminal.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SkillPanel.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ SkillRegister.tsx    # Skill æ³¨å†Œå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ SkillEditor.tsx      # Skill ç¼–è¾‘å™¨
â”‚   â”‚   â”‚   â””â”€â”€ SessionManager.tsx
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚       â”œâ”€â”€ websocket.ts
â”‚   â”‚       â””â”€â”€ skillAPI.ts          # Skill CRUD API
â”œâ”€â”€ docker/                 # å®¹å™¨é•œåƒ
â”‚   â”œâ”€â”€ claude-code/
â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”œâ”€â”€ entrypoint.sh
â”‚   â”‚   â””â”€â”€ skills/
â””â”€â”€ k8s/                    # K8s é…ç½®
    â”œâ”€â”€ deployments/
    â”œâ”€â”€ services/
    â””â”€â”€ istio/
```

## å¿«é€Ÿå¼€å§‹

### æœ¬åœ°æµ‹è¯• ttyd

```bash
# å®‰è£… ttyd
brew install ttyd  # macOS
apt install ttyd   # Ubuntu

# å¯åŠ¨æµ‹è¯•
ttyd --port 7681 --writable bash

# æµè§ˆå™¨è®¿é—®
open http://localhost:7681
```

### å®¹å™¨é•œåƒæ„å»º

```bash
cd docker/claude-code
docker build -t claude-code-sandbox:latest .
docker run -p 7681:7681 \
  -e USER_ID=test-user \
  -e SESSION_ID=test-session \
  claude-code-sandbox:latest
```

### å‰ç«¯å¼€å‘

```bash
cd frontend
npm install
npm run dev
```

### åç«¯å¼€å‘

```bash
cd backend/cmd/ws-proxy
go mod download
go run main.go
```

## å®ç°ç»†èŠ‚

è¯¦ç»†å®ç°æ–‡æ¡£è¯·æŸ¥çœ‹ï¼š
- [å®¹å™¨é…ç½®](./docker/claude-code/README.md)
- [å‰ç«¯å®ç°](./frontend/README.md)
- [åç«¯æœåŠ¡](./backend/README.md)
- [K8s éƒ¨ç½²](./k8s/README.md)

## å¾…åŠäº‹é¡¹

### åç«¯å¼€å‘
- [ ] å®ç° Go WebSocket Proxy è®¤è¯é€»è¾‘
- [ ] é…ç½® K8s Service å’Œ Istio Gateway
- [ ] å®ç°å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç† (åˆ›å»º/æš‚åœ/é”€æ¯)
- [ ] æ·»åŠ å¯¹è¯é‡‡é›† Hook Collector
- [ ] **å®ç° Skill Registry API (CRUD + åŒæ­¥æœºåˆ¶)**
- [ ] **Skill æƒé™æ§åˆ¶ (å®˜æ–¹/ä¸ªäºº/å…¬å¼€/å›¢é˜Ÿ)**
- [ ] ç›‘æ§å’Œæ—¥å¿—é‡‡é›†
- [ ] ç”¨æˆ·æ•°æ®æŒä¹…åŒ– (PVC)

### å‰ç«¯å¼€å‘
- [ ] å‰ç«¯ Skill Panel ç•Œé¢å®ç°
- [ ] **Skill Register ç•Œé¢å®ç°**
  - [ ] Skill åˆ›å»º/ç¼–è¾‘è¡¨å•
  - [ ] å‚æ•°é…ç½®ç•Œé¢
  - [ ] Skill é¢„è§ˆå’Œæµ‹è¯•åŠŸèƒ½
  - [ ] å…¬å¼€ Skill å¸‚åœº
  - [ ] Fork å’Œåˆ†äº«åŠŸèƒ½
- [ ] xterm.js Terminal é›†æˆ
- [ ] WebSocket è¿æ¥ç®¡ç†

### å®¹å™¨é•œåƒ
- [ ] æ„å»º Claude Code åŸºç¡€é•œåƒ
- [ ] é…ç½® Skill çƒ­åŠ è½½æœºåˆ¶
- [ ] é¢„è£…å¸¸ç”¨æ•°æ®åº“å®¢æˆ·ç«¯å·¥å…·
